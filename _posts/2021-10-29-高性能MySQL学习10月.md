---
layout:     post
title:      高性能MySQL学习10月
date:       2021-10-29
author:     Maorong
header-img: img/69530.jpg
catalog: true
tags:
    - MySQL
---

### 服务器逻辑架构
```
客户端
    连接线程处理
        查询缓存
        解析器
            优化器
                存储引擎
```
### 事务
#### 特性
1.原子（事务内所有sql为一个原子），一致（事务内所有sql一起提交），隔离，持久（永久保留在数据库中）  
#### 隔离级别
1.未提交读（READ UNCOMMITTED），事务可以读取未提交的数据，也叫脏读。  
2.提交读（READ COMMITED），一个事务从开始到提交所做的任务修改对其他事务都是不可见的，也叫不可重复读。  
3.可重复读（REPEATABLE READ），解决脏读的问题，保证同一个事务多次读取同样的记录结果是一致的，但随之会产生幻读（当一个事务读取某范围值时，另一个事务插入了新的记录，之前的事务再次读取改范围的记录，产生的幻行）的问题，InnoDB和XtraDB存储引擎通过多版本并发控制解决幻读问题（MVCC），可重复读时musql默认的事务隔离级别。  
4.可串行化（SERIALIZABLE），最高隔离级别，强制事务串行执行，避免了幻读，给每一行枷锁，导致大量的超时和锁争用的问题。  
#### 死锁
1.两个事务里的sql的锁被对方锁定，陷入的死循环。  
2.InnoDB目前处理死锁的方法是，将只有最少行级的排他锁（写锁）的事务进行回滚。？  
#### 事务日志
1.又称预写式日志，事务日志持久化之后，内存中被修改的数据在后台慢慢刷回到磁盘，修改数据要写两次磁盘。？

### 多版本并发控制
1.MVCC通过保存数据的某个时间点快照来实现  
2.通过两个隐藏列，一个列是保存行的创建时间，一个是行的过期时间（或删除时间）  
3.MVCC只在REPEATABLE READ 和 READ COMMITTED 两个隔离级别下工作  

### 存储引擎
1.数据库可称schema保存在数据目录下的一个子目录，创建表时，mysql会在数据库子目录下的创建一个和表同名的.frm文件来保存表的定义  

#### 行的格式
1.可选值Dynamic,Fixed或者Compressed,Dynamic的行长度是可变的如varchar和blob，Fixed的行长度是固定的，如char和interger